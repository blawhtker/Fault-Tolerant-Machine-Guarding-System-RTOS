# Engineering Analysis: Fault-Tolerant-Machine-Guarding-System-RTOS
 
## Scheduler Fit 
My task priorities guarantee every Hard Real-Time (H) task’s deadline by assigning the highest priority (3) to the `task_actuator_control` (Sector Scan). Because FreeRTOS uses a preemptive scheduler, this critical task interrupts any lower-priority task (like the Status Output or Klaxon) the moment it is signaled by the Master Arm switch or a sensor event. This ensures that the high-kinetic machine guarding logic is always processed immediately. The timestamped output proves this, as a fault occurring just after tick [5000] results in an immediate state change captured by the next cycle: 
 
```text 
[5000] Range = 350cm  STATUS: ARMED – ACTIVE – DANGER! KEEP CLEAR 2M 
[5250] Range = 150cm  FAULT: BREACH DETECTED – SHUT DOWN 
 

Race‑Proofing & Stale Data Prevention 

A race condition could occur with shared global state variables like system_state and is_perimeter_fouled. I protected these by making them volatile, ensuring the compiler never caches them and forces a fresh read from RAM every cycle. 

Additionally, I implemented Input Sanitization to prevent "Stale Semaphore" bugs. If the operator presses the Reset Button while the Master Arm is OFF, the semaphore buffer could store that click, causing an uncommanded restart upon re-arming. I fixed this by actively "draining" (taking) the semaphore inside the Safe-Mode loop to discard invalid inputs. 

C 

// Semaphore Drain Logic 
if (!is_armed) { 
    xSemaphoreTake(sem_reset_button, 0); // Discard invalid clicks 
} 

Worst‑Case Spike 

The heaviest load thrown at the prototype is a simultaneous asynchronous fault: triggering the Master Arm "Kill Switch" (Hardware Interrupt) at the exact same moment the ultrasonic sensor detects a breach. The RTOS scheduler handles this by immediately running the ISR, then context-switching to the highest-priority Control Task. The actual processing time for the safety logic is <20 microseconds. With a 10ms control loop, this leaves a safety margin of ~9.98ms, proving the system handles worst-case spikes without deadline slippage. 

Design Trade‑off 

I chose not to implement SD Card data logging (e.g., a "Black Box" recorder) to keep the system deterministic. File I/O operations are blocking and can have unpredictable write latencies (hundreds of milliseconds). Including this would verify the Hard Real-Time deadlines of the exclusion zone logic. The trade-off was to rely on lightweight serial telemetry to guarantee the safety interlocks remained rock-solid. 

Task & Deadline Analysis 

Task Name 

Priority 

Period 

Type 

Consequence of Failure 

Sector Scan Control 

3 (High) 

10ms 

Hard 

Catastrophic. Failure to arrest motor could cause crush injury. 

Perimeter Sensor 

2 (Med) 

50ms 

Hard 

Catastrophic. Missing a breach allows personnel into the danger zone. 

Klaxon Alarm 

2 (Med) 

Event 

Hard 

Severe. Failure to sound alarm delays personnel awareness of hazard. 

Status Output 

1 (Low) 

250ms 

Soft 

Minor. Telemetry delay does not impact physical safety. 

Power Monitor 

1 (Low) 

2000ms 

Soft 

Trivial. Heartbeat LED stutter has no safety impact. 

 

 

 

 

 

 

 

Plaintext 

================================================================================== 
                  Concurrency Diagram (Generated by Google Gemini) 
================================================================================== 
 
KEY: 
  [ Hardware ]        --> Signal (Semaphore)     --> 
  +----------+        ... Data (Shared Var)      ...> 
  | Task/ISR | 
  +----------+ 
 
---------------------------------------------------------------------------------- 
 
[ Master Arm Switch ] ........................................+ 
      .                                                      . 
      . (GPIO Polling)                                       . 
      V                                                      V 
+--------------------------+                         +---------------------------+ 
|   task_actuator_control  |<-- sem_reset_button ----|   isr_reset_button        |<-- [ RSO Reset Button ] 
|   (Priority 3 / Hard)    |                         |   (Hardware ISR)          | 
|   * Master Logic & Drain |                         +---------------------------+ 
+--------------------------+ 
      |        ^ 
      |        . 
      |        . (volatile system_state) 
      |        . 
      |        ......................................+............................ 
      V                                              .                           . 
[ Servo / Actuator ]                                 .                           . 
                                                     V                           V 
                                             +-----------------------+   +-----------------------+ 
                                             |  task_buzzer_alarm    |   |  task_telemetry_out   | 
                                             |  (Prio 2 / Event)     |   |  (Prio 1 / Soft)      | 
                                             +-----------------------+   +-----------------------+ 
                                                         |                           | 
                                                         V                           V 
                                                   [ Piezo Klaxon ]          [ Serial Monitor ] 
 
                                                                                 ^ 
[ Exclusion Sensor ]                                                             . 
      |                                                                          . 
      V                                                                          . 
+--------------------------+                                                     . 
|   task_perimeter_radar   |--- sem_perimeter_breach ----------------------------+ 
|   (Priority 2 / Hard)    |.....................................................^ 
+--------------------------+ 
 

 